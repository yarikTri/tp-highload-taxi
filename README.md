# Проектирование высоконагруженного агрегатора такси

### Автор - [Ярослав Кузьмин](https://park.vk.company/profile/iar.kuzmin/ "Страница на портале VK x МГТУ")

## Часть 1. Тема и целевая аудитория

### Тема курсовой работы - **"Проектирование сервиса агрегатора такси"**
В качестве примера и аналога выбран ведущий в России сервис заказа такси - [Яндекс.Такси](https://taxi.yandex.ru/)

### Ключевой функционал сервиса
- Регистрация и авторизация пользователей
- Заказ такси с выбором класса поездки (эконом/комфорт/бизнес и т.д.)
- Динамическое отслеживание машины/маршрута до и во время поездки - интеграция с картами
- Отдельная платформа для водителей
- Возможность внутрисервисной оплаты по привязанной банковской карте (не исключает возможность наличной оплаты или безналичного перевода водителю)

### Ключевые продуктовые решения
- Сбор CSAT'а с оцениванием водителя, поездки или удобства сервиса/приложения
- Фокус на увеличение доступности на любых мобильных устройствах с помощью минимально нагруженного клиента
- Динамическое ценообразование на основе доступности водителей в определённой зоне

### Целевая аудитория
- 40.2 млн активных пользователей в месяц в странах СНГ и EMEA [^1]
- Каждый пользователь в среднем совершает 7.3 поездок в месяц [^1]
- 67% заказов приходится на российский рынок [^1]

## Часть 2. Расчёт нагрузки (не завершено)

### Продуктовые метрики

#### MAU - 40.2 млн пользователей [^1]
#### DAU - 5 млн пользователей [^1]

#### Средний размер харанилища пользователя по типам:
| Хранимые данные   | Оценочный размер на пользователя      |
|-------------------|---------------------------------------|
| Персональные данные пользователя (ФИО, почта, пароль и т.д.) | Max 1 КБ       |
| Аватар              | ~ 1 МБ                              |
| Адреса              | ~ 100 Б \* кол-во адресов           |
| История поездок     | ~ 1 КБ \* кол-во поездок            |

**Итого оценочно:** 1 МБ 300 Б на пользователя при регистрации и вводе персональных данных, без поездок.

P.S.:
- При оценке учитывалась стандартная кодировка - 2 байта на символ
- Предполагается, что у пользователя в среднем 2 адреса - работа и дом

Некоторые выводы:
1. 7.3 поездок/месяц \* 40.2 млн MAU \* 1 КБ = 300.5 ГБ истории поездок будет прибавляться каждый месяц, если не брать в расчёт прирост MAU
2. Если брать с запасом общее число пользователей за 100 млн, то для хранения "статических" данных о пользователях
необходимо в худшем случае обеспечить пользователей 100 млн \* (1 МБ на аватарку + 1 КБ Б на персональные данные) = 100 ТБ + 100 ГБ.
Значит существенным образом размер хранилища (без разбиения на реляционное или S3) будет определяться количеством пользователей с аватарками.

#### Среднее количество действий пользователя по типам в день:
- 7,3 поездок в месяц / 30 ~= 0,24 поездок в день


### Технические метрики

#### Размер хранения в разбивке по типам данных:
-
  
#### Сетевой трафик
- Пиковое потребление в течение суток (Гбит/с) по типам трафика:
- Суммарный суточный трафик (Гбит/сутки) по типам трафика:

#### RPS по типам запросов:
-

### Список источников:
[^1]: [Финансовый отчёт Яндекса за Q2'2023](https://yastatic.net/s3/ir-docs/events/2023/Supplementary_slides_2Q23_RUS.pdf)
